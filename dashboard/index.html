<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>x.titan Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: {
                            950: '#020617',
                            900: '#0f172a',
                            800: '#1e293b',
                            700: '#334155',
                            600: '#475569',
                            500: '#64748b',
                            400: '#94a3b8',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>

<body class="bg-slate-950 text-slate-100 font-sans">
    <div id="app" class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside class="w-64 bg-slate-900 border-r border-slate-800 flex flex-col">
            <div class="p-6 border-b border-slate-800 flex items-center gap-2">
                <div
                    class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center font-bold text-white shadow-lg">
                    X</div>
                <span class="text-xl font-bold tracking-tight">x.titan</span>
            </div>
            <nav class="flex-1 p-4 space-y-2">
                <div class="text-xs font-semibold text-slate-500 uppercase px-4 mb-2 mt-2">Platform</div>
                <button onclick="showView('overview')" id="nav-overview"
                    class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg bg-blue-600/20 text-blue-400 border-r-2 border-blue-500">
                    ðŸ“Š Overview
                </button>
                <button onclick="showView('live')" id="nav-live"
                    class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-slate-400 hover:bg-slate-800">
                    ðŸ“¡ Live Monitor
                </button>
                <button onclick="showView('history')" id="nav-history"
                    class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-slate-400 hover:bg-slate-800">
                    ðŸ“œ Trade History
                </button>
                <button onclick="showView('analytics')" id="nav-analytics"
                    class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-slate-400 hover:bg-slate-800">
                    ðŸ“ˆ Analytics
                </button>
            </nav>
        </aside>

        <!-- Main -->
        <main class="flex-1 flex flex-col min-w-0">
            <header class="h-16 bg-slate-900/50 border-b border-slate-800 flex items-center justify-between px-6">
                <div class="flex items-center gap-4">
                    <h2 id="view-title" class="text-lg font-semibold">Overview</h2>
                    <span id="status-badge"
                        class="px-2 py-0.5 rounded text-xs bg-emerald-500/10 text-emerald-400 border border-emerald-500/20">
                        System Online
                    </span>
                </div>
                <div class="text-sm text-slate-400">
                    <span id="clock"></span>
                </div>
            </header>

            <div id="content" class="flex-1 overflow-y-auto p-6"></div>
        </main>
    </div>

    <script>
        // Data from real shadow trades
        let trades = [];
        let stats = { wins: 0, losses: 0, pending: 0 };

        // Load real data on startup
        async function loadRealData() {
            try {
                const resp = await fetch('data/trades.json');
                if (resp.ok) {
                    const data = await resp.json();
                    trades = data.map(t => ({
                        id: t.trade_id || t.signal_id || 'unknown',
                        time: t.timestamp,
                        direction: t.direction || 'CALL',
                        contract: t.contract_type || 'RISE_FALL',
                        probability: (t.probability || 0.5).toFixed(2),
                        regime: t.regime_state || 'TRUSTED',
                        outcome: t.outcome
                    }));
                    // Calculate stats
                    stats = { wins: 0, losses: 0, pending: 0 };
                    trades.forEach(t => {
                        if (t.outcome === true) stats.wins++;
                        else if (t.outcome === false) stats.losses++;
                        else stats.pending++;
                    });
                    console.log(`Loaded ${trades.length} real trades`);
                    showView('overview');
                } else {
                    console.warn('No trades.json found, using demo data');
                    generateDemoData();
                }
            } catch (e) {
                console.warn('Failed to load trades.json, using demo data:', e);
                generateDemoData();
            }
        }

        function generateDemoData() {
            const DIRECTIONS = ['CALL', 'PUT'];
            const CONTRACTS = ['RISE_FALL', 'TOUCH_NO_TOUCH', 'STAYS_BETWEEN'];
            for (let i = 0; i < 50; i++) {
                const outcome = Math.random() > 0.1 ? (Math.random() > 0.43 ? true : false) : null;
                if (outcome === true) stats.wins++;
                else if (outcome === false) stats.losses++;
                else stats.pending++;

                trades.push({
                    id: 'demo-' + Math.random().toString(36).substr(2, 6),
                    time: new Date(Date.now() - i * 900000).toISOString(),
                    direction: DIRECTIONS[Math.floor(Math.random() * 2)],
                    contract: CONTRACTS[Math.floor(Math.random() * 3)],
                    probability: (0.55 + Math.random() * 0.4).toFixed(2),
                    regime: Math.random() > 0.8 ? 'CAUTION' : 'TRUSTED',
                    outcome: outcome
                });
            }
            showView('overview');
        }

        function getRegimeBadge(regime) {
            const colors = {
                TRUSTED: 'bg-emerald-500/10 text-emerald-400 border-emerald-500/30',
                CAUTION: 'bg-amber-500/10 text-amber-400 border-amber-500/30',
                VETO: 'bg-red-500/10 text-red-400 border-red-500/30'
            };
            return `<span class="px-2 py-1 rounded-full text-xs border ${colors[regime]}">${regime}</span>`;
        }

        function getOutcomeBadge(outcome) {
            if (outcome === null) return '<span class="text-slate-500">PENDING</span>';
            return outcome
                ? '<span class="text-emerald-400 font-bold">WIN</span>'
                : '<span class="text-rose-400 font-bold">LOSS</span>';
        }

        // Views
        const views = {
            overview: () => {
                const winRate = stats.wins + stats.losses > 0
                    ? ((stats.wins / (stats.wins + stats.losses)) * 100).toFixed(1)
                    : '0.0';
                const profitFactor = stats.losses > 0
                    ? ((stats.wins * 0.95) / stats.losses).toFixed(2)
                    : '0.00';

                return `
                <div class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="bg-gradient-to-br from-indigo-900/50 to-purple-900/50 border border-indigo-500/20 rounded-xl p-6">
                            <h3 class="text-indigo-200 font-medium mb-2">Market Regime</h3>
                            ${getRegimeBadge(trades[0]?.regime || 'TRUSTED')}
                            <p class="text-sm text-indigo-300/80 mt-3">Vol-Expert stable. High confidence.</p>
                        </div>
                        <div class="bg-slate-900 border border-slate-800 rounded-xl p-6">
                            <h4 class="text-sm text-slate-400">Win Rate</h4>
                            <div class="text-2xl font-bold mt-1">${winRate}%</div>
                            <p class="text-xs text-slate-500 mt-1">${stats.wins}W - ${stats.losses}L</p>
                        </div>
                        <div class="bg-slate-900 border border-slate-800 rounded-xl p-6">
                            <h4 class="text-sm text-slate-400">Profit Factor</h4>
                            <div class="text-2xl font-bold mt-1">${profitFactor}</div>
                            <p class="text-xs ${profitFactor > 1 ? 'text-emerald-400' : 'text-slate-500'} mt-1">Expected &gt; 1.0</p>
                        </div>
                        <div class="bg-slate-900 border border-slate-800 rounded-xl p-6">
                            <h4 class="text-sm text-slate-400">Total Trades</h4>
                            <div class="text-2xl font-bold mt-1">${trades.length}</div>
                            <p class="text-xs text-slate-500 mt-1">${stats.pending} pending</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2 bg-slate-900 border border-slate-800 rounded-xl p-6">
                            <h3 class="font-semibold text-lg mb-4">Recent Performance</h3>
                            <div class="h-48 flex items-end gap-1">
                                ${trades.slice(0, 30).reverse().map((t, i) => {
                    const h = 20 + Math.random() * 80;
                    const color = t.outcome === null ? 'bg-slate-600' : t.outcome ? 'bg-emerald-500' : 'bg-rose-500';
                    return `<div class="flex-1 ${color} rounded-t opacity-70" style="height:${h}%"></div>`;
                }).join('')}
                            </div>
                        </div>
                        <div class="bg-slate-900 border border-slate-800 rounded-xl p-6">
                            <h3 class="font-semibold text-lg mb-4">Recent Signals</h3>
                            <div class="space-y-3 max-h-48 overflow-y-auto">
                                ${trades.slice(0, 5).map(t => `
                                    <div class="flex justify-between items-center p-2 rounded bg-slate-800/50">
                                        <div>
                                            <span class="${t.direction === 'CALL' ? 'text-emerald-400' : 'text-rose-400'} text-xs font-bold">${t.direction}</span>
                                            <span class="text-xs text-slate-500 ml-2">${t.contract.split('_')[0]}</span>
                                        </div>
                                        ${getOutcomeBadge(t.outcome)}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>`;
            },

            live: () => `
                <div class="max-w-4xl mx-auto space-y-6">
                    <div class="bg-emerald-950/30 border border-emerald-500/20 rounded-xl p-4 flex items-center gap-4">
                        <div class="relative">
                            <div class="w-3 h-3 bg-emerald-500 rounded-full animate-pulse"></div>
                        </div>
                        <div>
                            <h3 class="font-bold text-emerald-400">Live Connection Active</h3>
                            <p class="text-xs text-emerald-500/70">Simulated feed â€¢ Updates every 5s</p>
                        </div>
                    </div>
                    <div class="bg-slate-950 border border-slate-800 rounded-xl overflow-hidden">
                        <div class="bg-slate-900 px-4 py-2 border-b border-slate-800 text-xs text-slate-400 font-mono">System Log</div>
                        <div class="p-4 space-y-2 font-mono text-sm max-h-96 overflow-y-auto">
                            ${trades.slice(0, 10).map((t, i) => `
                                <div class="p-3 rounded border-l-4 ${i === 0 ? 'bg-slate-800 border-l-blue-500' : 'bg-slate-900/50 border-l-transparent'}">
                                    <span class="text-slate-500">[${t.time.split('T')[1].split('.')[0]}]</span>
                                    <span class="text-blue-400 ml-2">${t.contract}</span>
                                    <span class="${t.direction === 'CALL' ? 'text-green-400' : 'text-red-400'} ml-2">${t.direction}</span>
                                    <span class="text-slate-400 ml-2">${t.probability}%</span>
                                    <span class="float-right">${getRegimeBadge(t.regime)}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>`,

            history: () => `
                <div class="bg-slate-900 border border-slate-800 rounded-xl overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm">
                            <thead class="bg-slate-950 text-slate-400 border-b border-slate-800">
                                <tr>
                                    <th class="px-6 py-4">Time</th>
                                    <th class="px-6 py-4">ID</th>
                                    <th class="px-6 py-4">Contract</th>
                                    <th class="px-6 py-4">Direction</th>
                                    <th class="px-6 py-4">Confidence</th>
                                    <th class="px-6 py-4">Regime</th>
                                    <th class="px-6 py-4">Outcome</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-800">
                                ${trades.map(t => `
                                    <tr class="hover:bg-slate-800/30">
                                        <td class="px-6 py-3 text-slate-300">${t.time.split('T')[1].split('.')[0]}</td>
                                        <td class="px-6 py-3 font-mono text-xs text-slate-500">${t.id}</td>
                                        <td class="px-6 py-3 text-slate-300">${t.contract}</td>
                                        <td class="px-6 py-3"><span class="${t.direction === 'CALL' ? 'text-emerald-400' : 'text-rose-400'}">${t.direction}</span></td>
                                        <td class="px-6 py-3">${t.probability}%</td>
                                        <td class="px-6 py-3">${getRegimeBadge(t.regime)}</td>
                                        <td class="px-6 py-3">${getOutcomeBadge(t.outcome)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>`,

            analytics: () => {
                const byContract = {};
                trades.filter(t => t.outcome !== null).forEach(t => {
                    if (!byContract[t.contract]) byContract[t.contract] = { wins: 0, total: 0 };
                    byContract[t.contract].total++;
                    if (t.outcome) byContract[t.contract].wins++;
                });

                return `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-slate-900 border border-slate-800 rounded-xl p-6">
                        <h3 class="font-semibold text-lg mb-6">Win Rate by Contract Type</h3>
                        <div class="space-y-4">
                            ${Object.entries(byContract).map(([k, v]) => {
                    const wr = (v.wins / v.total * 100).toFixed(1);
                    return `
                                    <div>
                                        <div class="flex justify-between text-sm mb-1">
                                            <span class="text-slate-400">${k.replace('_', ' ')}</span>
                                            <span class="${wr > 55 ? 'text-emerald-400' : 'text-slate-400'}">${wr}%</span>
                                        </div>
                                        <div class="h-2 bg-slate-800 rounded-full overflow-hidden">
                                            <div class="h-full ${wr > 55 ? 'bg-emerald-500' : 'bg-blue-500'}" style="width:${wr}%"></div>
                                        </div>
                                    </div>`;
                }).join('')}
                        </div>
                    </div>
                    <div class="bg-slate-900 border border-slate-800 rounded-xl p-6">
                        <h3 class="font-semibold text-lg mb-6">Outcome Distribution</h3>
                        <div class="flex items-center justify-center gap-8 h-48">
                            <div class="text-center">
                                <div class="text-4xl font-bold text-emerald-400">${stats.wins}</div>
                                <div class="text-sm text-slate-400 mt-1">Wins</div>
                            </div>
                            <div class="text-center">
                                <div class="text-4xl font-bold text-rose-400">${stats.losses}</div>
                                <div class="text-sm text-slate-400 mt-1">Losses</div>
                            </div>
                            <div class="text-center">
                                <div class="text-4xl font-bold text-slate-400">${stats.pending}</div>
                                <div class="text-sm text-slate-400 mt-1">Pending</div>
                            </div>
                        </div>
                    </div>
                </div>`;
            }
        };

        function showView(name) {
            document.getElementById('content').innerHTML = views[name]();
            document.getElementById('view-title').textContent = name.charAt(0).toUpperCase() + name.slice(1);
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.className = btn.className.replace('bg-blue-600/20 text-blue-400 border-r-2 border-blue-500', 'text-slate-400 hover:bg-slate-800');
            });
            document.getElementById('nav-' + name).className = 'nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg bg-blue-600/20 text-blue-400 border-r-2 border-blue-500';
        }

        function updateClock() {
            document.getElementById('clock').textContent = new Date().toLocaleTimeString();
        }

        // Simulate new trades
        setInterval(() => {
            if (Math.random() > 0.7) {
                const outcome = Math.random() > 0.1 ? (Math.random() > 0.43 ? true : false) : null;
                if (outcome === true) stats.wins++;
                else if (outcome === false) stats.losses++;
                else stats.pending++;

                trades.unshift({
                    id: 'live-' + Math.random().toString(36).substr(2, 6),
                    time: new Date().toISOString(),
                    direction: DIRECTIONS[Math.floor(Math.random() * 2)],
                    contract: CONTRACTS[Math.floor(Math.random() * 3)],
                    probability: (0.60 + Math.random() * 0.39).toFixed(2),
                    regime: Math.random() > 0.85 ? 'CAUTION' : 'TRUSTED',
                    outcome: outcome
                });
                trades = trades.slice(0, 100);

                // Refresh current view
                const activeNav = document.querySelector('.nav-btn.bg-blue-600\\/20');
                if (activeNav) showView(activeNav.id.replace('nav-', ''));
            }
        }, 5000);

        // Init
        loadRealData();
        updateClock();
        setInterval(updateClock, 1000);
    </script>
</body>

</html>